# `RsvrBacklogMigTool` の機能

## 機能一覧

`RsvrBacklogMigTool` には以下のような機能が含まれます。

| 種別   | 機能名                | 説明 |
| ---   | ---                  | --- |
| 機能   | Backlog からデータを取り出して、操作者のPCにエクスポートする | Backlog API および h2 database などを使用して実現 |
| 機能   | 操作者のPCから Backlog にデータをインポートする | Backlog API および h2 database などを使用して実現 |
| 機能   | Backlog のエクスポート / インポートを別タイミングで実施できる | エクスポート後のデータを 操作者PCに保持することにより実現 |
| 機能   | Backlog のエクスポート / インポートをフェーズごとに実施できる | マスターの設定、ユーザのマッピング、ファイル、課題、Wiki について、フェーズに分かれており部分ごとにエクスポート/インポート操作が可能 |
| 機能   | エクスポート後データの格納ディレクトリを指定する機能 | コマンドラインインタフェースの引数により格納ディレクトリを指定可能 |
| 機能   | Backlog インポートにおける操作安全確認 | 規定ではプロジェクトキーが `MIGTEST` からはじまるもののみ操作可能とする。本番環境への操作には `-forceproduction` を付与して実現 |
| 機能   | Category をエクスポート/インポートする機能 | Category (カテゴリー) をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | CustomFieldSetting をエクスポートする機能 | CustomFieldSetting をエクスポートする機能 (インポートは未対応) |
| 機能   | File をエクスポートする機能 | File (共有ファイル) をエクスポートする機能 (インポートは対象外) |
| 機能   | Issue をエクスポート/インポートする機能 | Issue (課題) をエクスポートして、別の Backlogにインポートする機能。コメントやChangeLog、課題添付ファイルも対象 |
| 機能   | IssuePriorityType をエクスポート/インポートする機能 | IssuePriorityType をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | IssueResolutionType をエクスポート/インポートする機能 | IssueResolutionType をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | IssueStatusType をエクスポート/インポートする機能 | IssueStatusType をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | IssueType をエクスポート/インポートする機能 | IssueType をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | Milestone をエクスポート/インポートする機能 | Milestone (マイルストーン) をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | Project をエクスポートする機能 | Project をエクスポート(1件のみ)する機能 (インポートは対象外) |
| 機能   | User をエクスポートする機能 | User をエクスポートして情報をローカルに保持する機能 |
| 機能   | Backlog 間 User マッピングの管理表を新規に作成する機能 | User 同士のマッピングをあらわす管理表を新規作成する機能 (h2 database 上に BacklogMappingUser テーブル作成および現状のマッピングのレコードを追加) |
| 機能   | Backlog 間 User マッピングをメールアドレスをもとに自動で割当する機能 | User 同士のマッピングをあらわす管理表について、元と先のメールアドレスを手がかりに自動的に割当を実施する機能 |
| 機能   | Backlog 間 User マッピングをメールアドレスをもとに自動で割当する機能 | User 同士のマッピングをあらわす管理表について、元と先の名前を手がかりに自動的に割当を実施する機能 |
| 機能   | Backlog 間 User マッピングの状況を表示する機能 | User 同士のマッピングの状況について、標準エラー出力に状況を出力する機能 |
| 機能   | Backlog 間 User マッピングで未割当ユーザがいる場合は警告する機能 | User 同士のマッピングの状況について、未割当のユーザがいる場合は標準エラー出力に警告を出力する機能 |
| 機能   | Backlog 間の User のマッピングに従ってユーザを読み替える機能 | User 同志のマッピングの設定に従い、ユーザを読み替えてインポートする機能 |
| 機能   | Backlog 間の Userマッピングを編集する機能 | User 同志のマッピング設定を編集する機能については、本体では提供せずに h2 console などで BacklogMappingUser テーブル上のレコードの値を更新することによって実現 |
| 機能   | Version をエクスポート/インポートする機能 | Version (バージョン) をエクスポートして、別の Backlogにインポートする機能 |
| 機能   | Wiki をエクスポート/インポートする機能 | Wiki をエクスポートして、別の Backlogにインポートする機能。Wiki添付ファイルも含む |
| 機能   | Issue の親子関係を設定する機能 | Issue (課題) の親子関係をエクスポート/インポートします。処理の都合、Issueの転送と親子関係の設定は別フェーズになっています |
| 機能   | 削除されて欠番になった Issue を再現する機能 | 削除された Issue (課題) は欠番になりますが、インポート先の Backlog においても欠番であることを再現して番号を揃える機能 |
| 非機能 | コマンドラインインタフェース(CLI)をもちいたエクスポート、インポートの操作 | `org.kohsuke.args4j` ライブラリをもちいて実現 |
| 非機能 | ApiKey、スペース名、ProjectId、ドメイン名を指定する機能 | Backlog API 接続のために必要となる情報をコマンドラインインタフェースで指定する機能 |
| 非機能 | ローカルPC上のデータをリレーショナルデータベース形式で保持 | `h2 database`、`RsvrJdbc` をもちいて実現 |
| 非機能 | 主要メッセージは、専用のクラスで文字列を一元管理 | メッセージ定数クラスに主要メッセージをまとめて記述することにより可読性を向上 |
| 非機能 | Backlog API レート制限超えのリトライ機能 | Backlog API 呼び出しのレート制限(429)超えが発生した場合でも待機してリトライする機能 |
| 非機能 | Backlog API 呼び出し間隔制御機能 | Backlog API 呼び出し間隔をミリ秒指定で制御する機能 |
| 非機能 | 接続先プロジェクトが変わっていないことを確認する機能 | エクスポート/インポートのプロジェクトが別のものに変わっている場合に検知して処理を中断する機能 |
| 非機能 | インポート先の Issue が 0 件であることを確認する機能 | RsvrBaclogMigToolは作成直後の空のプロジェクトにのみインポートが可能 |
| 非機能 | 動作ログをデータベースに格納する機能 | ログのデータは標準出力とともに h2 database のデータファイルに格納します |

## 制限

- 主要なデータのみエクスポート/インポートされます。
- 各リソースの作成日・更新日は インポートしたタイミングの日時となります。
- Issue の「登録者」、「更新者」は Backlog API を呼び出した操作者となります。
- Issue の ChangeLog の一部は再現が不十分です。
- IssueType などにおける色指定はインポートから抜けます。
- Wiki のタグには対応していません。
- Category, Milestone, Version に一度値が設定され、その後値がクリアされた場合に、インポート先に値クリアが反映されません。
